<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Go学习 | emacsist</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="golang,go," />
  

  <meta name="description" content="安装多个版本的 goGVM Go依赖管理与 GOPATH 的关系.GOPATH环境变量中可以包含多个目录。 1go get 这种方式，它会将依赖下载在$GOPATH环境变量中的第一个目录中. 自己对Go中包的理解1234编写代码时，使用的`package`，表示代码所在的包名。引用时，`import package`，这个`package`表示相对于`GOPATH`中的`src`目录下的目录名，多">
<meta name="keywords" content="golang,go">
<meta property="og:type" content="article">
<meta property="og:title" content="Go学习">
<meta property="og:url" content="https://emacsist.github.io/2016/10/18/Go学习/index.html">
<meta property="og:site_name" content="emacsist">
<meta property="og:description" content="安装多个版本的 goGVM Go依赖管理与 GOPATH 的关系.GOPATH环境变量中可以包含多个目录。 1go get 这种方式，它会将依赖下载在$GOPATH环境变量中的第一个目录中. 自己对Go中包的理解1234编写代码时，使用的`package`，表示代码所在的包名。引用时，`import package`，这个`package`表示相对于`GOPATH`中的`src`目录下的目录名，多">
<meta property="og:updated_time" content="2017-11-03T08:15:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go学习">
<meta name="twitter:description" content="安装多个版本的 goGVM Go依赖管理与 GOPATH 的关系.GOPATH环境变量中可以包含多个目录。 1go get 这种方式，它会将依赖下载在$GOPATH环境变量中的第一个目录中. 自己对Go中包的理解1234编写代码时，使用的`package`，表示代码所在的包名。引用时，`import package`，这个`package`表示相对于`GOPATH`中的`src`目录下的目录名，多">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b870e52c6cd914cb42627e4a706700b7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  

  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header LEFT">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/books/"
            rel="noopener noreferrer"
            target="_self"
            >
            阅读
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装多个版本的-go"><span class="toc-text">安装多个版本的 go</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go依赖管理与-GOPATH-的关系"><span class="toc-text">Go依赖管理与 GOPATH 的关系.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自己对Go中包的理解"><span class="toc-text">自己对Go中包的理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang中的字符串拼接"><span class="toc-text">Golang中的字符串拼接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vscode中调试Go"><span class="toc-text">vscode中调试Go</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go单元测试"><span class="toc-text">Go单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单元测试某个指定的方法"><span class="toc-text">单元测试某个指定的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单元测试递归执行"><span class="toc-text">单元测试递归执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关于单元测试中的-Log-，-Logf"><span class="toc-text">关于单元测试中的 Log()， Logf()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang中类似Java中的toString-功能"><span class="toc-text">Golang中类似Java中的toString()功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#int64-to-String"><span class="toc-text">int64 to String</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过反射遍历结构体"><span class="toc-text">通过反射遍历结构体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将json字段串自动转化生成struct结构"><span class="toc-text">将json字段串自动转化生成struct结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json-字符串-转换为-struct"><span class="toc-text">json 字符串 转换为 struct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#struct-对象-转换为json字符串"><span class="toc-text">struct 对象 转换为json字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数中是否是指针的区别"><span class="toc-text">参数中是否是指针的区别:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用Go包"><span class="toc-text">常用Go包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见错误"><span class="toc-text">常见错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#http-ContentLength-xxx-with-Body-length-yyy"><span class="toc-text">http: ContentLength=xxx with Body length yyy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cannot-define-new-methods-on-non-local-type"><span class="toc-text">cannot define new methods on non-local type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#can’t-load-package-import-cycle-not-allowed"><span class="toc-text">can’t load package: import cycle not allowed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#too-many-arguments-to-return"><span class="toc-text">too many arguments to return</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#interface-is-pointer-to-interface-not-interface"><span class="toc-text">*interface {} is pointer to interface, not interface</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cannot-use-nil-as-type-xxx"><span class="toc-text">cannot use nil as type xxx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#found-packages-xxxx-and-xxxx-xxxx-in-xxxx"><span class="toc-text">found packages xxxx () and xxxx (xxxx) in xxxx</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#struct-结构体的继承"><span class="toc-text">struct 结构体的继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go中的字符串转换为字符数组"><span class="toc-text">Go中的字符串转换为字符数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang中顶级的JSON数组字符串转换为json对象"><span class="toc-text">Golang中顶级的JSON数组字符串转换为json对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建一个自定义的error"><span class="toc-text">创建一个自定义的error</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json数组转换为map"><span class="toc-text">json数组转换为map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go交叉编译"><span class="toc-text">Go交叉编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常见错误-1"><span class="toc-text">常见错误:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux下交叉编译Mac"><span class="toc-text">Linux下交叉编译Mac</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OS常量以及ARCH常量"><span class="toc-text">OS常量以及ARCH常量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go打包静态资源"><span class="toc-text">Go打包静态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#常用编译选项"><span class="toc-text">常用编译选项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#去掉调试信息"><span class="toc-text">去掉调试信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看优化的信息-内联-inline-信息、逃逸分析等"><span class="toc-text">查看优化的信息(内联 inline 信息、逃逸分析等)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数组与slice-区别"><span class="toc-text">数组与slice 区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go中使用-redis"><span class="toc-text">Go中使用 redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-中使用-gorm-与-mysql-交互"><span class="toc-text">Go 中使用 gorm 与 mysql 交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-中使用-rabbitmq"><span class="toc-text">go 中使用 rabbitmq</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注意事项"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go中long与timestamp-json的转换"><span class="toc-text">go中long与timestamp json的转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-中找出实现了某接口的代码"><span class="toc-text">Go 中找出实现了某接口的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang中实现优雅关闭程序"><span class="toc-text">Golang中实现优雅关闭程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#检查程序监控了哪些信号"><span class="toc-text">检查程序监控了哪些信号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang中的struct-tag使用"><span class="toc-text">Golang中的struct tag使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限制Goalng的HTTP-工作线程-goroutine"><span class="toc-text">限制Goalng的HTTP 工作线程(goroutine)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么我的内存没有被操作系统回收？"><span class="toc-text">为什么我的内存没有被操作系统回收？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang1-8-中的优雅关闭-http"><span class="toc-text">Golang1.8 中的优雅关闭 http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#按-github-风格的项目组织结构"><span class="toc-text">按 github 风格的项目组织结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#压缩编译后的文件大小"><span class="toc-text">压缩编译后的文件大小</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#去掉符号信息"><span class="toc-text">去掉符号信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-upx-压缩"><span class="toc-text">使用 upx 压缩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang-中的-web"><span class="toc-text">Golang 中的 web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#短声明注意"><span class="toc-text">短声明注意</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类型转换"><span class="toc-text">类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golang-中格式化日期"><span class="toc-text">Golang 中格式化日期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-中发送登录请求（保持-cookie"><span class="toc-text">Go 中发送登录请求（保持 cookie)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-中提交表单"><span class="toc-text">Go 中提交表单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logrus-设置日志时间格式"><span class="toc-text">logrus 设置日志时间格式</span></a></li></ol>
  </div>



<div class="content content-post LEFT">
   <article id="post-Go学习" class="article article-type-post" itemprop="blogPost">
    <header class="article-header">
        <h1 class="post-title">
            Go学习
        </h1>

        <div class="article-meta">
            <span>
        <i class="icon-calendar"></i>
        <span>2016.10.18</span>
            </span>

            
                <span class="article-author">
          <i class="icon-user"></i>
          <span>emacsist</span>
                </span>
                

                    
    <span class="article-category">
    <i class="icon-list"></i>
    
      <a class="tag-item" href="/tags/#go">
        <span class="tag-name">go</span>
    <span class="tag-size">( 15 )</span>
    </a>
    
      <a class="tag-item" href="/tags/#golang">
        <span class="tag-name">golang</span>
    <span class="tag-size">( 19 )</span>
    </a>
    

        </span>
        

                        

                                

                                        

        </div>
    </header>

    <div class="article-content">
        
                            <h2 id="安装多个版本的-go"><a href="#安装多个版本的-go" class="headerlink" title="安装多个版本的 go"></a>安装多个版本的 go</h2><p><a href="https://github.com/moovweb/gvm" target="_blank" rel="external">GVM</a></p>
<h2 id="Go依赖管理与-GOPATH-的关系"><a href="#Go依赖管理与-GOPATH-的关系" class="headerlink" title="Go依赖管理与 GOPATH 的关系."></a>Go依赖管理与 GOPATH 的关系.</h2><p><code>GOPATH</code>环境变量中可以包含多个目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go get</div></pre></td></tr></table></figure>
<p>这种方式，它会将依赖下载在<code>$GOPATH</code>环境变量中的第一个目录中.</p>
<h2 id="自己对Go中包的理解"><a href="#自己对Go中包的理解" class="headerlink" title="自己对Go中包的理解"></a>自己对Go中包的理解</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">编写代码时，使用的`package`，表示代码所在的包名。</div><div class="line"></div><div class="line">引用时，`import package`，这个`package`表示相对于`GOPATH`中的`src`目录下的目录名，多层目录，使用`/`分隔。</div><div class="line">一般来说，引用的`package`的名字，和你的最后一个目录的名字相同，但也可以不同。`import package`的名字，以所在包名的名字为准，而不是以目录名为准.</div></pre></td></tr></table></figure>
<h2 id="Golang中的字符串拼接"><a href="#Golang中的字符串拼接" class="headerlink" title="Golang中的字符串拼接"></a>Golang中的字符串拼接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    <span class="string">"bytes"</span></div><div class="line">    <span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">    var buffer bytes.Buffer</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i := 0; i &lt; 1000; i++ &#123;</div><div class="line">        buffer.WriteString(<span class="string">"a"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    fmt.Println(buffer.String())</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="vscode中调试Go"><a href="#vscode中调试Go" class="headerlink" title="vscode中调试Go"></a>vscode中调试Go</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">can<span class="string">'t load package: package .: no buildable Go source files in /ihome/go/golang-weibo-sdk</span></div><div class="line">exit status 1</div></pre></td></tr></table></figure>
<p>这个问题是由于你没有将设置指向main.go的所在目录里.即，在Go的debug设置里，要类似如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"version"</span>: <span class="string">"0.2.0"</span>,</div><div class="line">    <span class="string">"configurations"</span>: [&#123;</div><div class="line">        <span class="string">"name"</span>: <span class="string">"Launch"</span>,</div><div class="line">        <span class="string">"type"</span>: <span class="string">"go"</span>,</div><div class="line">        <span class="string">"request"</span>: <span class="string">"launch"</span>,</div><div class="line">        <span class="string">"mode"</span>: <span class="string">"debug"</span>,</div><div class="line">        <span class="string">"remotePath"</span>: <span class="string">""</span>,</div><div class="line">        <span class="string">"port"</span>: 2345,</div><div class="line">        <span class="string">"host"</span>: <span class="string">"127.0.0.1"</span>,</div><div class="line">        <span class="string">"program"</span>: <span class="string">"<span class="variable">$&#123;workspaceRoot&#125;</span>/src/main"</span>,</div><div class="line">        <span class="string">"env"</span>: &#123;&#125;,</div><div class="line">        <span class="string">"args"</span>: [],</div><div class="line">        <span class="string">"showLog"</span>: <span class="literal">true</span></div><div class="line">    &#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>即，<code>program</code>要设置为指向Go的main函数文件所在的目录即可.</p>
<h2 id="Go单元测试"><a href="#Go单元测试" class="headerlink" title="Go单元测试"></a>Go单元测试</h2><p>必须要将命令行，先切换到要进行单元测试文件的目录的根目录。比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$GOPATH</span>/src/utils/myutil.go</div><div class="line"><span class="variable">$GOPATH</span>/src/utils/myutil_test.go</div></pre></td></tr></table></figure>
<p>要想进行 <code>myutil_test.go</code> 的单元测试，则先切换到目录<code>$GOPATH/src/utils</code>，然后在该目录下执行命令:<code>go test</code>即可。</p>
<h3 id="单元测试某个指定的方法"><a href="#单元测试某个指定的方法" class="headerlink" title="单元测试某个指定的方法"></a>单元测试某个指定的方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go <span class="built_in">test</span> -run mehtodName</div></pre></td></tr></table></figure>
<h3 id="单元测试递归执行"><a href="#单元测试递归执行" class="headerlink" title="单元测试递归执行"></a>单元测试递归执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">进入到<span class="variable">$GOPATH</span>的根目录，然后按以下方式执行即可:</div><div class="line">go <span class="built_in">test</span> com.github.emacsist.weibosdk/api...</div></pre></td></tr></table></figure>
<h3 id="关于单元测试中的-Log-，-Logf"><a href="#关于单元测试中的-Log-，-Logf" class="headerlink" title="关于单元测试中的 Log()， Logf()"></a>关于单元测试中的 Log()， Logf()</h3><p>默认的情况下，<code>go test</code>并不会输出这些， 如果需要的话，可以添加<code>go test -v</code>来输出详细信息.</p>
<h2 id="Golang中类似Java中的toString-功能"><a href="#Golang中类似Java中的toString-功能" class="headerlink" title="Golang中类似Java中的toString()功能"></a>Golang中类似Java中的<code>toString()</code>功能</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package resp</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">// ErrorResp ： 错误码返回对象</div><div class="line"><span class="built_in">type</span> ErrorResp struct &#123;</div><div class="line">	Request   string `json:<span class="string">"request"</span>`</div><div class="line">	ErrorCode int32  `json:<span class="string">"error_code"</span>`</div><div class="line">	Error     string `json:<span class="string">"error"</span>`</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (errorResp *ErrorResp) String() string &#123;</div><div class="line">	<span class="built_in">return</span> fmt.Sprintf(<span class="string">"request=%v\nErrorCode=%v\nError=%v\n"</span>, errorResp.Request, errorResp.ErrorCode, errorResp.Error)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>即为它添加一个方法 <code>String() string</code>即可，这样子，在调用<code>fmt.Printf()</code>这些格式化打印时，就会自动调用对象的<code>String()</code>方法来打印了.</p>
<h2 id="int64-to-String"><a href="#int64-to-String" class="headerlink" title="int64 to String"></a>int64 to String</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">import <span class="string">"strconv"</span></div><div class="line"></div><div class="line">strconv.FormatInt(int64Value, 10)</div></pre></td></tr></table></figure>
<h2 id="通过反射遍历结构体"><a href="#通过反射遍历结构体" class="headerlink" title="通过反射遍历结构体"></a>通过反射遍历结构体</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"reflect"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Age  int</div><div class="line">	Name string</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	p := Person&#123;Age: 10, Name: <span class="string">"HelloWorld"</span>&#125;</div><div class="line"></div><div class="line">	refValue := reflect.ValueOf(&amp;p)</div><div class="line"></div><div class="line">	fields := refValue.Elem()</div><div class="line">	<span class="keyword">for</span> i := 0; i &lt; fields.NumField(); i++ &#123;</div><div class="line">		field := fields.Field(i)</div><div class="line">		fieldName := fields.Type().Field(i).Name</div><div class="line">		fieldValue := field.Interface()</div><div class="line">		fmt.Printf(<span class="string">"fieldName = %v, fieldValue = %v\n"</span>, fieldName, fieldValue)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>要注意的是，<code>fieldName</code>是通过<code>fields</code>这个来获取的.</p>
<p>如果想要将字段的值转换为确定类型的值，则就可以这样子做:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"reflect"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Age  int</div><div class="line">	Name string</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	p := Person&#123;Age: 10, Name: <span class="string">"HelloWorld"</span>&#125;</div><div class="line"></div><div class="line">	refValue := reflect.ValueOf(&amp;p)</div><div class="line"></div><div class="line">	fields := refValue.Elem()</div><div class="line">	<span class="keyword">for</span> i := 0; i &lt; fields.NumField(); i++ &#123;</div><div class="line">		field := fields.Field(i)</div><div class="line">		fieldName := fields.Type().Field(i).Name</div><div class="line"></div><div class="line">		<span class="keyword">if</span> field.Type().Name() == <span class="string">"string"</span> &#123;</div><div class="line">			fieldValue := field.Interface().(string)</div><div class="line">			fmt.Printf(<span class="string">"string --&gt; fieldName = %v, fieldValue = %v\n"</span>, fieldName, fieldValue)</div><div class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> field.Type().Name() == <span class="string">"int"</span> &#123;</div><div class="line">			fieldValue := field.Interface().(int)</div><div class="line">			fmt.Printf(<span class="string">"int --&gt; fieldName = %v, fieldValue = %v\n"</span>, fieldName, fieldValue)</div><div class="line">		&#125;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="将json字段串自动转化生成struct结构"><a href="#将json字段串自动转化生成struct结构" class="headerlink" title="将json字段串自动转化生成struct结构"></a>将json字段串自动转化生成struct结构</h2><p><a href="http://json2struct.mervine.net/" target="_blank" rel="external">mervine.net</a><br><a href="https://mholt.github.io/json-to-go/" target="_blank" rel="external">mholt.github.io</a></p>
<h3 id="json-字符串-转换为-struct"><a href="#json-字符串-转换为-struct" class="headerlink" title="json 字符串 转换为 struct"></a>json 字符串 转换为 struct</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import <span class="string">"encoding/json"</span></div><div class="line"></div><div class="line">json.Unmarshal([]byte(body), &amp;status)</div></pre></td></tr></table></figure>
<h3 id="struct-对象-转换为json字符串"><a href="#struct-对象-转换为json字符串" class="headerlink" title="struct 对象 转换为json字符串"></a>struct 对象 转换为json字符串</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p为结构体变量</div><div class="line">body, error := json.Marshal(p)</div></pre></td></tr></table></figure>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">// Person : <span class="built_in">test</span> object</div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Name string</div><div class="line">	Age  int</div><div class="line">&#125;</div><div class="line"></div><div class="line">func changeValue(p Person) &#123;</div><div class="line">	p.Age = 10</div><div class="line">&#125;</div><div class="line"></div><div class="line">func changeValue2(p *Person) &#123;</div><div class="line">	p.Age = 10</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	p := Person&#123;Age: 1, Name: <span class="string">"HelloWorld"</span>&#125;</div><div class="line">	changeValue(p)</div><div class="line">	fmt.Printf(<span class="string">"changeValue, name -&gt;%v, age -&gt; %v\n"</span>, p.Name, p.Age)</div><div class="line">	changeValue2(&amp;p)</div><div class="line">	fmt.Printf(<span class="string">"changeValue2, name -&gt;%v, age -&gt; %v\n"</span>, p.Name, p.Age)</div><div class="line"></div><div class="line">	body, _ := json.Marshal(p)</div><div class="line">	fmt.Printf(<span class="string">"struct to json -&gt; %v\n"</span>, string(body))</div><div class="line"></div><div class="line">	newP := Person&#123;&#125;</div><div class="line">	fmt.Printf(<span class="string">"newP age -&gt; %v\n"</span>, newP.Age)</div><div class="line">	json.Unmarshal(body, &amp;newP)</div><div class="line">	fmt.Printf(<span class="string">"after json to struct -&gt; %v\n"</span>, newP.Age)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出的结果为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[Running] go run <span class="string">"/ihome/go/golang-weibo-sdk/src/main/main.go"</span></div><div class="line">changeValue, name -&gt;HelloWorld, age -&gt; 1</div><div class="line">changeValue2, name -&gt;HelloWorld, age -&gt; 10</div><div class="line">struct to json -&gt; &#123;<span class="string">"Name"</span>:<span class="string">"HelloWorld"</span>,<span class="string">"Age"</span>:10&#125;</div><div class="line">newP age -&gt; 0</div><div class="line">after json to struct -&gt; 10</div><div class="line"></div><div class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.13 seconds</div></pre></td></tr></table></figure>
<h2 id="参数中是否是指针的区别"><a href="#参数中是否是指针的区别" class="headerlink" title="参数中是否是指针的区别:"></a>参数中是否是指针的区别:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import <span class="string">"fmt"</span></div><div class="line"></div><div class="line">// Person : <span class="built_in">test</span> object</div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Name string</div><div class="line">	Age  int</div><div class="line">&#125;</div><div class="line"></div><div class="line">func changeValue(p Person) &#123;</div><div class="line">	p.Age = 10</div><div class="line">&#125;</div><div class="line"></div><div class="line">func changeValue2(p *Person) &#123;</div><div class="line">	p.Age = 10</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	p := Person&#123;Age: 1, Name: <span class="string">"HelloWorld"</span>&#125;</div><div class="line">	changeValue(p)</div><div class="line">	fmt.Printf(<span class="string">"changeValue, name -&gt;%v, age -&gt; %v\n"</span>, p.Name, p.Age)</div><div class="line">	changeValue2(&amp;p)</div><div class="line">	fmt.Printf(<span class="string">"changeValue2, name -&gt;%v, age -&gt; %v\n"</span>, p.Name, p.Age)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出的结果为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Running] go run <span class="string">"/ihome/go/golang-weibo-sdk/src/main/main.go"</span></div><div class="line">changeValue, name -&gt;HelloWorld, age -&gt; 1</div><div class="line">changeValue2, name -&gt;HelloWorld, age -&gt; 10</div><div class="line"></div><div class="line">[Done] exited with code=0 <span class="keyword">in</span> 0.103 seconds</div></pre></td></tr></table></figure>
<h2 id="常用Go包"><a href="#常用Go包" class="headerlink" title="常用Go包"></a>常用Go包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">将struct转换为查询参数:</div><div class="line">https://godoc.org/github.com/google/go-querystring/query</div></pre></td></tr></table></figure>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><h3 id="http-ContentLength-xxx-with-Body-length-yyy"><a href="#http-ContentLength-xxx-with-Body-length-yyy" class="headerlink" title="http: ContentLength=xxx with Body length yyy"></a>http: ContentLength=xxx with Body length yyy</h3><p>ContentLength=299 with Body length 367</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">这一般是request对象前后的长度不一致（中间关闭了或处理了，导致后面的再次读取时不一致）</div></pre></td></tr></table></figure>
<p>参考: <a href="http://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0" target="_blank" rel="external">stackoverflow</a></p>
<p>具体例子：我是在构造<code>request</code>时这样子写:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">bodyBuf := &amp;bytes.Buffer&#123;&#125;</div><div class="line">bodyWriter := multipart.NewWriter(bodyBuf)</div><div class="line"></div><div class="line">v := reflect.ValueOf(param)</div><div class="line">fileds := v.Elem()</div><div class="line"></div><div class="line">paramsMap := netURL.Values&#123;&#125;</div><div class="line">//defer bodyWriter.Close()</div><div class="line"></div><div class="line"><span class="built_in">return</span> http.NewRequest(<span class="string">"POST"</span>, URL, bodyBuf)</div></pre></td></tr></table></figure>
<p>关键是那行：<code>defer bodyWriter.Close()</code>，注释掉这行就可以了.</p>
<h3 id="cannot-define-new-methods-on-non-local-type"><a href="#cannot-define-new-methods-on-non-local-type" class="headerlink" title="cannot define new methods on non-local type"></a>cannot define new methods on non-local type</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">type</span> MyRouter mux.Router</div><div class="line"></div><div class="line">func (m *MyRouter) <span class="function"><span class="title">F</span></span>() &#123; ... &#125;</div><div class="line"></div><div class="line">或者</div><div class="line"></div><div class="line"><span class="built_in">type</span> MyRouter struct &#123;</div><div class="line">    *mux.Router</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (m *MyRouter) <span class="function"><span class="title">F</span></span>() &#123; ... &#125;</div><div class="line"></div><div class="line">...</div><div class="line">r := &amp;MyRouter&#123;router&#125;</div><div class="line">r.F()</div></pre></td></tr></table></figure>
<h3 id="can’t-load-package-import-cycle-not-allowed"><a href="#can’t-load-package-import-cycle-not-allowed" class="headerlink" title="can’t load package: import cycle not allowed"></a>can’t load package: import cycle not allowed</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">package project/controllers/account</div><div class="line">    imports project/controllers/base</div><div class="line">    imports project/components/mux</div><div class="line">    imports project/controllers/account</div></pre></td></tr></table></figure>
<p>这表明有循环引用，循环引用的结果为:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">         project/controllers/account</div><div class="line">            ^                    \    </div><div class="line">           /                      \</div><div class="line">          /                        \ </div><div class="line">         /                         \/</div><div class="line">project/components/mux &lt;--- project/controllers/base</div></pre></td></tr></table></figure>
<p>只要处理掉这个循环引用的一条链即可解决.</p>
<h3 id="too-many-arguments-to-return"><a href="#too-many-arguments-to-return" class="headerlink" title="too many arguments to return"></a>too many arguments to return</h3><p>一般来说，是你的方法签名中没有返回值，但你却进行了<code>return value</code>或者，你的方法签名中的返回值个数与<code>return 语句不匹配</code></p>
<h3 id="interface-is-pointer-to-interface-not-interface"><a href="#interface-is-pointer-to-interface-not-interface" class="headerlink" title="*interface {} is pointer to interface, not interface"></a>*interface {} is pointer to interface, not interface</h3><p>这个应该是你想在方法里进行泛型例如写成这样子:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">package helper</div><div class="line"></div><div class="line">import <span class="string">"reflect"</span></div><div class="line"></div><div class="line">// SetDefaultValues : 设置参数默认值</div><div class="line">func SetDefaultValues(param *interface&#123;&#125;) &#123;</div><div class="line">	v := reflect.ValueOf(param)</div><div class="line">	fileds := v.Elem()</div><div class="line">	<span class="keyword">for</span> i := 0; i &lt; fileds.NumField(); i++ &#123;</div><div class="line">		field := fileds.Field(i)</div><div class="line">		// Ignore fields that don<span class="string">'t have the same type as a string</span></div><div class="line">		if field.Type().Name() == "string" &#123;</div><div class="line">			//如果是一个字符串对象</div><div class="line">			if field.CanSet() &#123;</div><div class="line">				field.SetString("")</div><div class="line">			&#125;</div><div class="line">		&#125; else if field.Type().Name() == "int" || field.Type().Name() == "int64" &#123;</div><div class="line">			//如果是整型</div><div class="line">			if field.CanSet() &#123;</div><div class="line">				field.SetInt(-1)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但其实<code>interface{}</code>它表示的是接收任意的类型（包括指针），所以，这里不能这样子，应该修改参数为:<code>param interface{}</code>即可。</p>
<p>这样子，在调用方法时，传递的是指针，那么它就代表指针，传递的是普通类型，那就是普通类型。</p>
<h3 id="cannot-use-nil-as-type-xxx"><a href="#cannot-use-nil-as-type-xxx" class="headerlink" title="cannot use nil as type xxx"></a>cannot use nil as type xxx</h3><p>这表你的xxx并不能接受<code>nil</code>值。（一般来说，只有指针类型才能接受nil值)</p>
<h3 id="found-packages-xxxx-and-xxxx-xxxx-in-xxxx"><a href="#found-packages-xxxx-and-xxxx-xxxx-in-xxxx" class="headerlink" title="found packages xxxx () and xxxx (xxxx) in xxxx"></a>found packages xxxx () and xxxx (xxxx) in xxxx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">┌─[sky@sky-linux] - [/ihome/go/golang-weibo-sdk/src/com.github.emacsist.weibosdk/api/business/status] - [2016-10-21 05:40:43]                              </div><div class="line">└─[2] &lt;git:(master 3c154e3✱✈) &gt; go <span class="built_in">test</span> -run StatusesRepostTimelineBizString                                                                               </div><div class="line">../../../helper/HttpHelper.go:8:2: found packages resp (CommentsAndTotalNumberResp.go) and api (TagsTagsBatchOther.go) <span class="keyword">in</span> /ihome/go/golang-weibo-sdk/src/co</div><div class="line">m.github.emacsist.weibosdk/resp</div></pre></td></tr></table></figure>
<p>Go语言规则，所有在同一个目录的源文件，都必须是同属一个包的.解决了这个问题就可以编译通过了.</p>
<h2 id="struct-结构体的继承"><a href="#struct-结构体的继承" class="headerlink" title="struct 结构体的继承"></a>struct 结构体的继承</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// Person : <span class="built_in">test</span> object</div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Name string</div><div class="line">	Age  int</div><div class="line">	Animal</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">type</span> Animal struct &#123;</div><div class="line">    Colour string</div><div class="line">    Name string</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Go中的字符串转换为字符数组"><a href="#Go中的字符串转换为字符数组" class="headerlink" title="Go中的字符串转换为字符数组"></a>Go中的字符串转换为字符数组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import <span class="string">"fmt"</span></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">    fmt.Println(string(<span class="string">"Hello"</span>[1]))              // ASCII only</div><div class="line">    fmt.Println(string([]rune(<span class="string">"Hello, 世界"</span>)[1])) // UTF-8</div><div class="line">    fmt.Println(string([]rune(<span class="string">"Hello, 世界"</span>)[8])) // UTF-8</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>千万要注意：<code>string[0:1]</code>这种形式是按<code>字节</code>来分隔的.<code>len(string)</code>返回的是字节数.<br>要操作字符的话，则要使用<code>rune</code>类型。</p>
<h2 id="Golang中顶级的JSON数组字符串转换为json对象"><a href="#Golang中顶级的JSON数组字符串转换为json对象" class="headerlink" title="Golang中顶级的JSON数组字符串转换为json对象"></a>Golang中顶级的JSON数组字符串转换为json对象</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import <span class="string">"fmt"</span></div><div class="line">import <span class="string">"encoding/json"</span></div><div class="line"></div><div class="line"><span class="built_in">type</span> PublicKey struct &#123;</div><div class="line">	Id  int</div><div class="line">	Key string</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	keysBody := []byte(`[&#123;<span class="string">"id"</span>: 1,<span class="string">"key"</span>: <span class="string">"-"</span>&#125;,&#123;<span class="string">"id"</span>: 2,<span class="string">"key"</span>: <span class="string">"-"</span>&#125;,&#123;<span class="string">"id"</span>: 3,<span class="string">"key"</span>: <span class="string">"-"</span>&#125;]`)</div><div class="line">	keys := make([]PublicKey, 0)</div><div class="line">	json.Unmarshal(keysBody, &amp;keys)</div><div class="line">	fmt.Printf(<span class="string">"%#v"</span>, keys[2].Id)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="创建一个自定义的error"><a href="#创建一个自定义的error" class="headerlink" title="创建一个自定义的error"></a>创建一个自定义的error</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import <span class="string">"errors"</span></div><div class="line"></div><div class="line">errors.New(<span class="string">"xx"</span>)</div></pre></td></tr></table></figure>
<h2 id="json数组转换为map"><a href="#json数组转换为map" class="headerlink" title="json数组转换为map"></a>json数组转换为map</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	h := `[</div><div class="line">    &#123;</div><div class="line">        <span class="string">"221012100001985342"</span>: <span class="string">"80后"</span>,</div><div class="line">        <span class="string">"weight"</span>: 50</div><div class="line">    &#125;,</div><div class="line">     &#123;</div><div class="line">        <span class="string">"221012100001985342"</span>: <span class="string">"80后1"</span>,</div><div class="line">        <span class="string">"weight"</span>: 51</div><div class="line">    &#125;</div><div class="line">]`</div><div class="line">	var hell []map[string]interface&#123;&#125;</div><div class="line"></div><div class="line">	err := json.Unmarshal([]byte(h), &amp;hell)</div><div class="line">	fmt.Printf(<span class="string">"%v\n"</span>, err)</div><div class="line">	fmt.Printf(<span class="string">"%v\n"</span>, h)</div><div class="line">	fmt.Printf(<span class="string">"%v\n"</span>, hell)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Go交叉编译"><a href="#Go交叉编译" class="headerlink" title="Go交叉编译"></a>Go交叉编译</h2><p>进入Go的安装目录<code>cd $GOROOT/src</code>，然后 选择要生成的目标构架的工具链:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># windows64位</span></div><div class="line">CGO_ENABLED=0 GOOS=windows GOARCH=amd64 ./make.bash</div><div class="line"></div><div class="line"><span class="comment"># mac</span></div><div class="line">CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 ./make.bash</div><div class="line"></div><div class="line"><span class="comment"># linux 64</span></div><div class="line">CGO_ENABLED=0 GOOS=linux GOARCH=amd64 ./make.bash</div></pre></td></tr></table></figure>
<h3 id="常见错误-1"><a href="#常见错误-1" class="headerlink" title="常见错误:"></a>常见错误:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">┌─[sky@sky-linux] - [/ihome/go/go-current/src] - [2016-10-26 02:14:42]</div><div class="line">└─[0] &lt;&gt; CGO_ENABLED=0 GOOS=windows GOARCH=amd64 ./make.bash</div><div class="line"><span class="comment">##### Building Go bootstrap tool.</span></div><div class="line">cmd/dist</div><div class="line">ERROR: Cannot find /home/sky/go1.4/bin/go.</div><div class="line">Set <span class="variable">$GOROOT_BOOTSTRAP</span> to a working Go tree &gt;= Go 1.4.</div></pre></td></tr></table></figure>
<p>这表需要有一个<code>&gt;=1.4</code>的另一个<code>go</code>安装目录，并将<code>GOROOT_BOOTSTRAP</code>指向该目录即可.</p>
<h3 id="Linux下交叉编译Mac"><a href="#Linux下交叉编译Mac" class="headerlink" title="Linux下交叉编译Mac"></a>Linux下交叉编译Mac</h3><p><a href="http://stackoverflow.com/questions/34084597/cross-compilation-of-cgo-for-darwin-fails" target="_blank" rel="external">stackoverflow</a></p>
<h3 id="OS常量以及ARCH常量"><a href="#OS常量以及ARCH常量" class="headerlink" title="OS常量以及ARCH常量"></a>OS常量以及ARCH常量</h3><p><a href="https://github.com/golang/go/blob/master/src/go/build/syslist.go" target="_blank" rel="external">syslist</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">package build</div><div class="line"></div><div class="line">const goosList = <span class="string">"android darwin dragonfly freebsd linux nacl netbsd openbsd plan9 solaris windows zos "</span></div><div class="line">const goarchList = <span class="string">"386 amd64 amd64p32 arm armbe arm64 arm64be ppc64 ppc64le mips mipsle mips64 mips64le mips64p32 mips64p32le ppc s390 s390x sparc sparc64 "</span></div></pre></td></tr></table></figure>
<h2 id="Go打包静态资源"><a href="#Go打包静态资源" class="headerlink" title="Go打包静态资源"></a>Go打包静态资源</h2><p>安装: <code>go get -u github.com/jteeuwen/go-bindata/...</code></p>
<p><a href="https://github.com/jteeuwen/go-bindata" target="_blank" rel="external">go-bindata</a></p>
<p>假设<code>/tmp/go</code>是一个<code>$GOPATH</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">┌─[sky@sky-linux] - [/tmp/go] - [2016-10-26 03:25:55]</div><div class="line">└─[0] &lt;&gt; ll /tmp/go/src/nlp/dict</div><div class="line">total 820K</div><div class="line">-rw-r--r-- 1 sky sky 3.1K 10月 25 18:36 adv_full.txt</div><div class="line">-rw-r--r-- 1 sky sky 3.2K 10月 25 18:36 adv.txt</div><div class="line">-rw-r--r-- 1 sky sky 212K 10月 25 18:36 neg_full.txt</div><div class="line">-rw-r--r-- 1 sky sky 305K 10月 25 18:36 neg.txt</div><div class="line">-rw-r--r-- 1 sky sky  273 10月 25 18:36 not_full.txt</div><div class="line">-rw-r--r-- 1 sky sky  287 10月 25 18:36 not.txt</div><div class="line">-rw-r--r-- 1 sky sky 116K 10月 25 18:36 pos_full.txt</div><div class="line">-rw-r--r-- 1 sky sky 149K 10月 25 18:36 pos.txt</div><div class="line">-rw-r--r-- 1 sky sky 8.0K 10月 25 21:21 stp_full.txt</div><div class="line">-rw-r--r-- 1 sky sky 8.0K 10月 25 18:36 stp.txt</div><div class="line"></div><div class="line">┌─[sky@sky-linux] - [/tmp/go] - [2016-10-26 12:35:32]                                                                                                                      </div><div class="line">└─[0] &lt;&gt; ./bin/go-bindata -o=src/nlp/asset/asset.go -pkg=asset -prefix <span class="string">"/tmp/go/src/nlp/"</span> /tmp/go/src/nlp/dict</div></pre></td></tr></table></figure>
<p>说明：</p>
<p><code>-o</code> : 表示生成静态资源的访问包的文件.<br><code>-pkg</code> ： 表示包名<br><code>-prefix</code> ： 表示自动添加的前缀。</p>
<p><code>/tmp/go/src/nlp/dict</code>表示静态资源的目录.如果要递归的话，可以这样子写: <code>/tmp/go/src/nlp/dict/...</code></p>
<p>成功后，可以看到生成了一个新的文件:<code>/tmp/go/src/nlp/asset/asset.go</code></p>
<p>使用例子:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">import (</div><div class="line">	<span class="string">"nlp/asset"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">init</span></span>() &#123;</div><div class="line">	fmt.Printf(<span class="string">"init --&gt; %v\n"</span>, asset.AssetNames())</div><div class="line">	loadDict(<span class="string">"dict/adv_full.txt"</span>, &amp;advMap)</div><div class="line">	loadDict(<span class="string">"dict/neg_full.txt"</span>, &amp;negMap)</div><div class="line">	loadDict(<span class="string">"dict/not_full.txt"</span>, &amp;notMap)</div><div class="line">	loadDict(<span class="string">"dict/pos_full.txt"</span>, &amp;posMap)</div><div class="line">	loadDict(<span class="string">"dict/stp_full.txt"</span>, &amp;stpMap)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func loadDict(path string, dic *map[string]bool) &#123;</div><div class="line">	//<span class="string">"dict/adv_full.txt"</span></div><div class="line">	data, _ := asset.Asset(path)</div><div class="line">	bufferReader := bytes.NewReader(data)</div><div class="line">	scan := bufio.NewScanner(bufferReader)</div><div class="line">	<span class="keyword">for</span> scan.<span class="function"><span class="title">Scan</span></span>() &#123;</div><div class="line">		t := scan.Text()</div><div class="line">		(*dic)[t] = <span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为我们添加了<code>-prefix &quot;/tmp/go/src/nlp/&quot;</code>, 所以，我们可以直接这样子： <code>dict/adv_full.txt</code>的路径，就可以通过<code>asset.Asset(&quot;dict/adv_full.txt&quot;)</code>来访问我们的静态资源了.</p>
<h3 id="常用编译选项"><a href="#常用编译选项" class="headerlink" title="常用编译选项"></a>常用编译选项</h3><p>输出所有可用编译选项:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go tool compile -<span class="built_in">help</span></div></pre></td></tr></table></figure>
<h4 id="去掉调试信息"><a href="#去掉调试信息" class="headerlink" title="去掉调试信息"></a>去掉调试信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go build -ldflags <span class="string">'-w'</span></div></pre></td></tr></table></figure>
<h4 id="查看优化的信息-内联-inline-信息、逃逸分析等"><a href="#查看优化的信息-内联-inline-信息、逃逸分析等" class="headerlink" title="查看优化的信息(内联 inline 信息、逃逸分析等)"></a>查看优化的信息(内联 inline 信息、逃逸分析等)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go build -gcflags=-m</div></pre></td></tr></table></figure>
<h2 id="数组与slice-区别"><a href="#数组与slice-区别" class="headerlink" title="数组与slice 区别"></a>数组与slice 区别</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import <span class="string">"fmt"</span></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	arr := [...]int&#123;0, 1, 2, 3, 4, 5, 6, 7, 8, 9&#125;</div><div class="line">	sliceArray := arr[3:5]</div><div class="line"></div><div class="line">	// 由此可知，slice是一种引用类型，因为它的第一个元素地址，与arr[3]的地址是一样的</div><div class="line">	fmt.Printf(<span class="string">"arr[3] address = %v\n"</span>, &amp;arr[3])</div><div class="line">	fmt.Printf(<span class="string">"sliceArray[0] address = %v\n"</span>, &amp;sliceArray[0])</div><div class="line"></div><div class="line">	// len = 2</div><div class="line">	fmt.Printf(<span class="string">"len slice = %v\n"</span>, len(sliceArray))</div><div class="line"></div><div class="line">	// <span class="built_in">cap</span> = 7，<span class="built_in">cap</span>的计算，是从第一个slice元素的位置，到原数组的结尾的长度.</div><div class="line">	fmt.Printf(<span class="string">"cap slice = %v\n"</span>, <span class="built_in">cap</span>(sliceArray))</div><div class="line"></div><div class="line">	// 因为sliceArray的<span class="built_in">cap</span>为7,已经存在2个，那还可以容纳5个元素，这时引用的，还是arr数组，这样子append后，会修改arr的内容</div><div class="line">	// arr 为 : [0 1 2 3 4 1 2 3 4 5]</div><div class="line">	// sliceArray 为 : [3 4 1 2 3 4 5</div><div class="line">	sliceArray = append(sliceArray, 1, 2, 3, 4, 5)</div><div class="line"></div><div class="line">	// 当<span class="built_in">cap</span>还在arr容纳范围之内时，slice指向的就是arr,通过打印他们的地址可知:</div><div class="line">	fmt.Printf(<span class="string">"arr[5] address = %v， value=%v\n"</span>, &amp;arr[6], arr[6])</div><div class="line">	fmt.Printf(<span class="string">"sliceArray[2] address = %v, value=%v\n"</span>, &amp;sliceArray[3], sliceArray[3])</div><div class="line"></div><div class="line">	//但当sliceArray超过了<span class="built_in">cap</span>时: [3 4 1 2 3 4 5 1 2 3 4 5]</div><div class="line">	sliceArray = append(sliceArray, 1, 2, 3, 4, 5)</div><div class="line">	// 可以发现，它指向了一个新的数组:因为他们的地址不同了.</div><div class="line">	fmt.Printf(<span class="string">"arr[5] address = %v， value=%v\n"</span>, &amp;arr[6], arr[6])</div><div class="line">	fmt.Printf(<span class="string">"sliceArray[2] address = %v, value=%v\n"</span>, &amp;sliceArray[3], sliceArray[3])</div><div class="line">	fmt.Printf(<span class="string">"cap slice = %v\n"</span>, <span class="built_in">cap</span>(sliceArray))</div><div class="line"></div><div class="line">	fmt.Printf(<span class="string">"%v, %v\n"</span>, arr, sliceArray)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>append超出cap之前与之后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import <span class="string">"fmt"</span></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	arr := [...]int&#123;0, 1, 2, 3, 4, 5, 6, 7, 8, 9&#125;</div><div class="line">	sliceArray := arr[3:5]</div><div class="line">	sliceArray2 := arr[3:5]</div><div class="line"></div><div class="line">	fmt.Printf(<span class="string">"%v, %v, %v\n"</span>, arr, sliceArray, sliceArray2)</div><div class="line">	fmt.Printf(<span class="string">"%v, %v, %v\n"</span>, &amp;arr[3], &amp;sliceArray[0], &amp;sliceArray2[0])</div><div class="line"></div><div class="line">	sliceArray = append(sliceArray, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23)</div><div class="line"></div><div class="line">	fmt.Printf(<span class="string">"%v, %v, %v\n"</span>, arr, sliceArray, sliceArray2)</div><div class="line">	fmt.Printf(<span class="string">"%v, %v, %v\n"</span>, &amp;arr[3], &amp;sliceArray[0], &amp;sliceArray2[0])</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Go中使用-redis"><a href="#Go中使用-redis" class="headerlink" title="Go中使用 redis"></a>Go中使用 redis</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"flag"</span></div><div class="line">	<span class="string">"time"</span></div><div class="line"></div><div class="line">	<span class="string">"fmt"</span></div><div class="line"></div><div class="line">	<span class="string">"github.com/garyburd/redigo/redis"</span></div><div class="line">)</div><div class="line"></div><div class="line">func newPool(server, password string) *redis.Pool &#123;</div><div class="line">	<span class="built_in">return</span> &amp;redis.Pool&#123;</div><div class="line">		MaxIdle:     3,</div><div class="line">		IdleTimeout: 240 * time.Second,</div><div class="line">		Dial: func() (redis.Conn, error) &#123;</div><div class="line">			c, err := redis.Dial(<span class="string">"tcp"</span>, server)</div><div class="line">			<span class="keyword">if</span> err != nil &#123;</div><div class="line">				<span class="built_in">return</span> nil, err</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> len(password) &gt; 0 &#123;</div><div class="line">				<span class="keyword">if</span> _, err := c.Do(<span class="string">"AUTH"</span>, password); err != nil &#123;</div><div class="line">					c.Close()</div><div class="line">					<span class="built_in">return</span> nil, err</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="built_in">return</span> c, err</div><div class="line">		&#125;,</div><div class="line">		TestOnBorrow: func(c redis.Conn, t time.Time) error &#123;</div><div class="line">			<span class="keyword">if</span> time.Since(t) &lt; time.Minute &#123;</div><div class="line">				<span class="built_in">return</span> nil</div><div class="line">			&#125;</div><div class="line">			_, err := c.Do(<span class="string">"PING"</span>)</div><div class="line">			<span class="built_in">return</span> err</div><div class="line">		&#125;,</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var (</div><div class="line">	pool          *redis.Pool</div><div class="line">	redisServer   = flag.String(<span class="string">"redisServer"</span>, <span class="string">":6379"</span>, <span class="string">""</span>)</div><div class="line">	redisPassword = flag.String(<span class="string">"redisPassword"</span>, <span class="string">""</span>, <span class="string">""</span>)</div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	redisGet()</div><div class="line">	redisPipline()</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">redisGet</span></span>() &#123;</div><div class="line">	redisConnection := pool.Get()</div><div class="line">	defer redisConnection.Close()</div><div class="line"></div><div class="line">	//如果这个不为空，表明获取链接时出错</div><div class="line">	<span class="keyword">if</span> redisConnection.Err() != nil &#123;</div><div class="line">		fmt.Printf(<span class="string">"Hello World %v\n"</span>, redisConnection.Err().Error())</div><div class="line">		<span class="built_in">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	val, err := redisConnection.Do(<span class="string">"get"</span>, <span class="string">"hello2"</span>)</div><div class="line">	<span class="keyword">if</span> err == nil &#123;</div><div class="line">		fmt.Printf(<span class="string">"Hello %v\n"</span>, string(val.([]uint8)))</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"happen error : %v\n"</span>, err.Error())</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">redisPipline</span></span>() &#123;</div><div class="line">	redisConnection := pool.Get()</div><div class="line">	defer redisConnection.Close()</div><div class="line"></div><div class="line">	//如果这个不为空，表明获取链接时出错</div><div class="line">	<span class="keyword">if</span> redisConnection.Err() != nil &#123;</div><div class="line">		fmt.Printf(<span class="string">"Hello World %v\n"</span>, redisConnection.Err().Error())</div><div class="line">		<span class="built_in">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	redisConnection.Send(<span class="string">"get"</span>, <span class="string">"hello"</span>)</div><div class="line">	redisConnection.Send(<span class="string">"get"</span>, <span class="string">"hello1"</span>)</div><div class="line">	redisConnection.Send(<span class="string">"get"</span>, <span class="string">"hello2"</span>)</div><div class="line"></div><div class="line">	redisConnection.Flush()</div><div class="line"></div><div class="line">	<span class="keyword">for</span> i := 0; i &lt; 3; i++ &#123;</div><div class="line">		data, err := redisConnection.Receive()</div><div class="line"></div><div class="line">		<span class="keyword">if</span> err == nil &amp;&amp; redisConnection.Err() == nil &#123;</div><div class="line">			<span class="keyword">if</span> data == nil &#123;</div><div class="line">				<span class="built_in">continue</span></div><div class="line">			&#125;</div><div class="line">			fmt.Printf(<span class="string">"Hello from pipline %v\n"</span>, string(data.([]uint8)))</div><div class="line">			<span class="built_in">continue</span></div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Hello from pipline error %v\n"</span>, err.Error())</div><div class="line">			<span class="built_in">break</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"done\n"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">init</span></span>() &#123;</div><div class="line">	flag.Parse()</div><div class="line">	fmt.Printf(<span class="string">"redis: server = %v, passwd = %v\n"</span>, *redisServer, *redisPassword)</div><div class="line">	pool = newPool(*redisServer, *redisPassword)</div><div class="line">	fmt.Printf(<span class="string">"init redis connection pool ok\n"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意，这个默认是<code>db 0</code>，如果想实现选择（虽然不推荐使用多个DB），可以按如下链接做:</p>
<p><a href="http://stackoverflow.com/questions/25708256/golang-selecting-db-on-a-redispool-in-redigo" target="_blank" rel="external">stackoverflow</a></p>
<h2 id="Go-中使用-gorm-与-mysql-交互"><a href="#Go-中使用-gorm-与-mysql-交互" class="headerlink" title="Go 中使用 gorm 与 mysql 交互"></a>Go 中使用 gorm 与 mysql 交互</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line"></div><div class="line">	<span class="string">"time"</span></div><div class="line"></div><div class="line">	<span class="string">"github.com/jinzhu/gorm"</span></div><div class="line">	_ <span class="string">"github.com/jinzhu/gorm/dialects/mysql"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="built_in">type</span> WbStatus struct &#123;</div><div class="line">	ID       int64 `gorm:<span class="string">"primary_key"</span>`</div><div class="line">	Text     string</div><div class="line">	CreateAt time.Time</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (WbStatus) TableName() string &#123;</div><div class="line">	<span class="built_in">return</span> <span class="string">"wb_status"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">var db *gorm.DB</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	<span class="keyword">if</span> db == nil &#123;</div><div class="line">		panic(<span class="string">"db is nil"</span>)</div><div class="line">	&#125;</div><div class="line">	var wbstatus WbStatus</div><div class="line">	fmt.Printf(<span class="string">"tableName = %v\n"</span>, wbstatus.TableName())</div><div class="line">	db.First(&amp;wbstatus)</div><div class="line"></div><div class="line">	fmt.Printf(<span class="string">"rowId = %v\n"</span>, wbstatus.ID)</div><div class="line">	fmt.Printf(<span class="string">"createAt = %v\n"</span>, wbstatus.CreateAt)</div><div class="line">	defer db.Close()</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">init</span></span>() &#123;</div><div class="line">	var err error</div><div class="line">	db, err = gorm.Open(<span class="string">"mysql"</span>, <span class="string">"root:yang@(127.0.0.1:3306)/test?charset=utf8&amp;parseTime=True&amp;loc=Local"</span>)</div><div class="line">	<span class="keyword">if</span> err != nil &#123;</div><div class="line">		fmt.Printf(<span class="string">"init mysql error : %v\n"</span>, err.Error())</div><div class="line">		panic(<span class="string">"exit"</span>)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> db == nil &#123;</div><div class="line">		fmt.Printf(<span class="string">"init mysql error : db is null\n"</span>)</div><div class="line">		panic(<span class="string">"exit"</span>)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"init mysql  : db isnot null\n"</span>)</div><div class="line">	&#125;</div><div class="line">	db.DB().SetMaxOpenConns(100)</div><div class="line">	db.DB().SetMaxIdleConns(10)</div><div class="line">	fmt.Printf(<span class="string">"init mysql OK\n"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://jinzhu.me/gorm/" target="_blank" rel="external">gorm</a></p>
<h2 id="go-中使用-rabbitmq"><a href="#go-中使用-rabbitmq" class="headerlink" title="go 中使用 rabbitmq"></a>go 中使用 rabbitmq</h2><p><a href="https://github.com/streadway/amqp" target="_blank" rel="external">github amqp</a></p>
<p><a href="http://stackoverflow.com/questions/36179111/whether-to-create-connection-every-time-when-amqp-dial-is-threadsafe-or-not-in-g" target="_blank" rel="external">whether-to-create-connection-every-time-when-amqp-dial-is-threadsafe-or-not-in-golang</a></p>
<p><a href="https://ninefinity.org/post/ensuring-rabbitmq-connection-in-golang/" target="_blank" rel="external">ensuring-rabbitmq-connection-in-golang</a></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ch, _ := mqCon.Channel()</div><div class="line">	msgs, err := ch.Consume(</div><div class="line">		config.Configuration.Rabbit.Listen,     // queue</div><div class="line">		config.Configuration.Rabbit.ConsumerID, // consumer</div><div class="line">		<span class="literal">true</span>,  // auto-ack</div><div class="line">		<span class="literal">false</span>, // exclusive</div><div class="line">		<span class="literal">false</span>, // no-local</div><div class="line">		<span class="literal">false</span>, // no-wait</div><div class="line">		nil,   // args</div><div class="line">	)</div></pre></td></tr></table></figure>
<p>如果你将<code>auto-ack</code>设置为true，则不用手工确认消息。如果设置为<code>false</code>，则必须手工调用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Delivery.Ack, Delivery.Reject or Delivery.Nack</div></pre></td></tr></table></figure>
<p><a href="https://agocs.org/blog/2014/08/19/rabbitmq-best-practices-in-go/" target="_blank" rel="external">rabbitmq-best-practices-in-go</a></p>
<p><code>autoAck</code>:</p>
<blockquote>
<p>When autoAck (also known as noAck) is true, the server will acknowledge<br>deliveries to this consumer prior to writing the delivery to the network.  When<br>autoAck is true, the consumer should not call Delivery.Ack.  Automatically<br>acknowledging deliveries means that some deliveries may get lost if the<br>consumer is unable to process them after the server delivers them.</p>
</blockquote>
<h2 id="go中long与timestamp-json的转换"><a href="#go中long与timestamp-json的转换" class="headerlink" title="go中long与timestamp json的转换"></a>go中long与timestamp json的转换</h2><p><a href="http://stackoverflow.com/questions/31744970/convert-to-time-in-golang-from-milliseconds" target="_blank" rel="external">convert-to-time-in-golang-from-milliseconds</a></p>
<p><code>type A B只是让A获得B的内存模型而已。A不会继承B的方法，但A和B可以使用A()或B()来互相转换。</code></p>
<p><a href="http://golangtc.com/t/57fdbb43b09ecc08ce000121" target="_blank" rel="external">golangtc</a></p>
<h2 id="Go-中找出实现了某接口的代码"><a href="#Go-中找出实现了某接口的代码" class="headerlink" title="Go 中找出实现了某接口的代码"></a>Go 中找出实现了某接口的代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">egrep -nr <span class="string">'^func (.*) ReadByte\('</span> *</div></pre></td></tr></table></figure>
<h2 id="Golang中实现优雅关闭程序"><a href="#Golang中实现优雅关闭程序" class="headerlink" title="Golang中实现优雅关闭程序"></a>Golang中实现优雅关闭程序</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line"></div><div class="line">	sigs := make(chan os.Signal, 1)</div><div class="line">	<span class="keyword">done</span> := make(chan bool, 1)</div><div class="line"></div><div class="line">	// sigs 表示将收到的信号放到这个管道中。后面的参数表示你想处理的系统信号</div><div class="line">	signal.Notify(sigs, syscall.SIGINT, syscall.SIGTERM)</div><div class="line"></div><div class="line">	//开启一个Go routine来监听信号</div><div class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</div><div class="line">		sig := &lt;-sigs</div><div class="line">		<span class="keyword">done</span> &lt;- <span class="literal">true</span></div><div class="line">	&#125;()</div><div class="line"></div><div class="line">	//这里添加你的程序的功能（监听器，处理器等）</div><div class="line">	fmt.Println(<span class="string">"awaiting signal"</span>)</div><div class="line">	&lt;-<span class="keyword">done</span></div><div class="line">	fmt.Println(<span class="string">"exiting"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>常见信号:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">Signal Name	Number	Description</div><div class="line">SIGHUP	1	Hangup (POSIX)</div><div class="line">SIGINT	2	Terminal interrupt (ANSI)</div><div class="line">SIGQUIT	3	Terminal quit (POSIX)</div><div class="line">SIGILL	4	Illegal instruction (ANSI)</div><div class="line">SIGTRAP	5	Trace <span class="built_in">trap</span> (POSIX)</div><div class="line">SIGIOT	6	IOT Trap (4.2 BSD)</div><div class="line">SIGBUS	7	BUS error (4.2 BSD)</div><div class="line">SIGFPE	8	Floating point exception (ANSI)</div><div class="line">SIGKILL	9	Kill(can<span class="string">'t be caught or ignored) (POSIX)</span></div><div class="line">SIGUSR1	10	User defined signal 1 (POSIX)</div><div class="line">SIGSEGV	11	Invalid memory segment access (ANSI)</div><div class="line">SIGUSR2	12	User defined signal 2 (POSIX)</div><div class="line">SIGPIPE	13	Write on a pipe with no reader, Broken pipe (POSIX)</div><div class="line">SIGALRM	14	Alarm clock (POSIX)</div><div class="line">SIGTERM	15	Termination (ANSI)</div><div class="line">SIGSTKFLT	16	Stack fault</div><div class="line">SIGCHLD	17	Child process has stopped or exited, changed (POSIX)</div><div class="line">SIGCONT	18	Continue executing, if stopped (POSIX)</div><div class="line">SIGSTOP	19	Stop executing(can't be caught or ignored) (POSIX)</div><div class="line">SIGTSTP	20	Terminal stop signal (POSIX)</div><div class="line">SIGTTIN	21	Background process trying to <span class="built_in">read</span>, from TTY (POSIX)</div><div class="line">SIGTTOU	22	Background process trying to write, to TTY (POSIX)</div><div class="line">SIGURG	23	Urgent condition on socket (4.2 BSD)</div><div class="line">SIGXCPU	24	CPU <span class="built_in">limit</span> exceeded (4.2 BSD)</div><div class="line">SIGXFSZ	25	File size <span class="built_in">limit</span> exceeded (4.2 BSD)</div><div class="line">SIGVTALRM	26	Virtual alarm clock (4.2 BSD)</div><div class="line">SIGPROF	27	Profiling alarm clock (4.2 BSD)</div><div class="line">SIGWINCH	28	Window size change (4.3 BSD, Sun)</div><div class="line">SIGIO	29	I/O now possible (4.2 BSD)</div><div class="line">SIGPWR	30	Power failure restart (System V)</div></pre></td></tr></table></figure>
<h3 id="检查程序监控了哪些信号"><a href="#检查程序监控了哪些信号" class="headerlink" title="检查程序监控了哪些信号"></a>检查程序监控了哪些信号</h3><p><a href="http://unix.stackexchange.com/questions/85364/how-can-i-check-what-signals-a-process-is-listening-to" target="_blank" rel="external">signals</a></p>
<h2 id="Golang中的struct-tag使用"><a href="#Golang中的struct-tag使用" class="headerlink" title="Golang中的struct tag使用"></a>Golang中的struct tag使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"reflect"</span></div><div class="line">)</div><div class="line"></div><div class="line">// Person :</div><div class="line"><span class="built_in">type</span> Person struct &#123;</div><div class="line">	Name string `mytag:<span class="string">"HelloName"</span>`</div><div class="line">&#125;</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	p := Person&#123;Name: <span class="string">"emacsist"</span>&#125;</div><div class="line">	refValue := reflect.ValueOf(&amp;p)</div><div class="line"></div><div class="line">	fields := refValue.Elem()</div><div class="line">	<span class="keyword">for</span> i := 0; i &lt; fields.NumField(); i++ &#123;</div><div class="line">		field := fields.Field(i)</div><div class="line">		fieldName := fields.Type().Field(i).Name</div><div class="line">		fieldValue := field.Interface()</div><div class="line">		fieldTag := fields.Type().Field(i).Tag.Get(<span class="string">"mytag"</span>)</div><div class="line">		fmt.Printf(<span class="string">"fieldName = %v, fieldValue = %v, tagName = %v\n"</span>, fieldName, fieldValue, fieldTag)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="限制Goalng的HTTP-工作线程-goroutine"><a href="#限制Goalng的HTTP-工作线程-goroutine" class="headerlink" title="限制Goalng的HTTP 工作线程(goroutine)"></a>限制Goalng的HTTP 工作线程(goroutine)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">connectionCount := 5000</div><div class="line"></div><div class="line">l, err := net.Listen(<span class="string">"tcp"</span>, <span class="string">":9090"</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> err != nil &#123;</div><div class="line">	log.Fatalf(<span class="string">"Listen: %v"</span>, err)</div><div class="line">&#125;</div><div class="line"></div><div class="line">l = netutil.LimitListener(l, connectionCount)</div><div class="line">log.Fatal(http.Serve(l, nil))</div><div class="line">logrus.Infof(<span class="string">"start server success. %v"</span>, ListenAddress)</div></pre></td></tr></table></figure>
<h2 id="为什么我的内存没有被操作系统回收？"><a href="#为什么我的内存没有被操作系统回收？" class="headerlink" title="为什么我的内存没有被操作系统回收？"></a>为什么我的内存没有被操作系统回收？</h2><p><a href="http://stackoverflow.com/questions/24376817/go-1-3-garbage-collector-not-releasing-server-memory-back-to-system" target="_blank" rel="external">stackoverflow</a></p>
<p><a href="https://golang.org/pkg/runtime/debug/" target="_blank" rel="external">golang</a></p>
<h2 id="Golang1-8-中的优雅关闭-http"><a href="#Golang1-8-中的优雅关闭-http" class="headerlink" title="Golang1.8 中的优雅关闭 http"></a>Golang1.8 中的优雅关闭 http</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">s := &amp;http.Server&#123;</div><div class="line">	Addr: <span class="string">":9090"</span>,</div><div class="line">&#125;</div><div class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">	log.Infof(<span class="string">"%s"</span>, s.ListenAndServe())</div><div class="line">&#125;()</div><div class="line"><span class="comment">// Handle SIGINT and SIGTERM.</span></div><div class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal)</div><div class="line">signal.Notify(ch, syscall.SIGINT, syscall.SIGTERM)</div><div class="line">log.Println(&lt;-ch)</div><div class="line"></div><div class="line">log.Println(<span class="string">"http server gracefully stopping..."</span>)</div><div class="line"><span class="comment">// Stop the service gracefully.</span></div><div class="line">s.Shutdown(context.Background())</div><div class="line">log.Println(<span class="string">"http server gracefully shutdown done..."</span>)</div></pre></td></tr></table></figure>
<h2 id="按-github-风格的项目组织结构"><a href="#按-github-风格的项目组织结构" class="headerlink" title="按 github 风格的项目组织结构"></a>按 github 风格的项目组织结构</h2><p><a href="https://github.com/golang/go/wiki/GithubCodeLayout" target="_blank" rel="external">github code layout</a></p>
<h2 id="压缩编译后的文件大小"><a href="#压缩编译后的文件大小" class="headerlink" title="压缩编译后的文件大小"></a>压缩编译后的文件大小</h2><h3 id="去掉符号信息"><a href="#去掉符号信息" class="headerlink" title="去掉符号信息"></a>去掉符号信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">go build -ldflags <span class="string">"-s -w"</span></div></pre></td></tr></table></figure>
<h3 id="使用-upx-压缩"><a href="#使用-upx-压缩" class="headerlink" title="使用 upx 压缩"></a>使用 upx 压缩</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">upx -9 GoBinaryFile</div></pre></td></tr></table></figure>
<h2 id="Golang-中的-web"><a href="#Golang-中的-web" class="headerlink" title="Golang 中的 web"></a>Golang 中的 web</h2><p>在 web 中使用 panic 只会退出当前的 goroutine ，而不会整个应用程序退出。</p>
<p>在一般应用中，如果没有捕捉 panic() 的话，就会导致整个应用退出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"sync"</span></div><div class="line">	<span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">	wg := sync.WaitGroup&#123;&#125;</div><div class="line">	wg.Add(1)</div><div class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</div><div class="line">		time.Sleep(5 * time.Second)</div><div class="line">		println(<span class="string">"Hello World"</span>)</div><div class="line">		panic(<span class="string">"==================&gt;"</span>)</div><div class="line">	&#125;()</div><div class="line"></div><div class="line">	go <span class="function"><span class="title">func</span></span>() &#123;</div><div class="line">		time.Sleep(2 * time.Second)</div><div class="line">		println(<span class="string">"Hello World2"</span>)</div><div class="line">		panic(<span class="string">"==================&gt;2"</span>)</div><div class="line">	&#125;()</div><div class="line">	wg.Wait()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="短声明注意"><a href="#短声明注意" class="headerlink" title="短声明注意"></a>短声明注意</h2><p>短声明只能声明局部变量，而且它会覆盖外部的同名变量。</p>
<p>所以，如果目的是想进行外部变量的初始化的话，这点可能没达到我们想要的目的，这点要特别注意。</p>
<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>不论显式还是隐式的 <em>常量</em> 的类型转换，常量从一种类型转换为另一种类型，都要求目标类型能够表示 <em>原值</em></p>
<h2 id="Golang-中格式化日期"><a href="#Golang-中格式化日期" class="headerlink" title="Golang 中格式化日期"></a>Golang 中格式化日期</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">YYYY-MM-DD HH:mm:ss </div><div class="line">对应</div><div class="line">2006-01-02 15:04:05</div></pre></td></tr></table></figure>
<h2 id="Go-中发送登录请求（保持-cookie"><a href="#Go-中发送登录请求（保持-cookie" class="headerlink" title="Go 中发送登录请求（保持 cookie)"></a>Go 中发送登录请求（保持 cookie)</h2><p><a href="https://stackoverflow.com/questions/18414212/golang-how-to-follow-location-with-cookie" target="_blank" rel="external">stackoverflow.com</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">    <span class="string">"golang.org/x/net/publicsuffix"</span></div><div class="line">    <span class="string">"io/ioutil"</span></div><div class="line">    <span class="string">"log"</span></div><div class="line">    <span class="string">"net/http"</span></div><div class="line">    <span class="string">"net/http/cookiejar"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>() &#123;</div><div class="line">    options := cookiejar.Options&#123;</div><div class="line">        PublicSuffixList: publicsuffix.List,</div><div class="line">    &#125;</div><div class="line">    jar, err := cookiejar.New(&amp;options)</div><div class="line">    <span class="keyword">if</span> err != nil &#123;</div><div class="line">        log.Fatal(err)</div><div class="line">    &#125;</div><div class="line">    client := http.Client&#123;Jar: jar&#125;</div><div class="line">    resp, err := client.Get(<span class="string">"http://dubbelboer.com/302cookie.php"</span>)</div><div class="line">    <span class="keyword">if</span> err != nil &#123;</div><div class="line">        log.Fatal(err)</div><div class="line">    &#125;</div><div class="line">    data, err := ioutil.ReadAll(resp.Body)</div><div class="line">    resp.Body.Close()</div><div class="line">    <span class="keyword">if</span> err != nil &#123;</div><div class="line">        log.Fatal(err)</div><div class="line">    &#125;</div><div class="line">    log.Println(string(data))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Go-中提交表单"><a href="#Go-中提交表单" class="headerlink" title="Go 中提交表单"></a>Go 中提交表单</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">form := url.Values&#123;&#125;</div><div class="line">form.Add(<span class="string">"qps"</span>, strconv.FormatInt(qps, 10))</div><div class="line"></div><div class="line"></div><div class="line">setQPSRequest, err := http.NewRequest(<span class="string">"POST"</span>, loginURL, strings.NewReader(form.Encode()))</div><div class="line"><span class="keyword">if</span> err != nil &#123;</div><div class="line">	<span class="built_in">return</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">setQPSRequest.Header.Set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded; charset=utf-8"</span>)</div></pre></td></tr></table></figure>
<h2 id="logrus-设置日志时间格式"><a href="#logrus-设置日志时间格式" class="headerlink" title="logrus 设置日志时间格式"></a>logrus 设置日志时间格式</h2><p>logrus 设置日期</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">func <span class="function"><span class="title">init</span></span>() &#123;</div><div class="line">	formatter := &amp;logrus.TextFormatter&#123;</div><div class="line">		FullTimestamp: <span class="literal">true</span>,</div><div class="line">	&#125;</div><div class="line">	logrus.SetFormatter(formatter)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
                                
    </div>
</article>

   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持 emacsist</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/img/wxpay.jpeg" alt="">
          </li>
        
          <li class="item">
            <img src="/img/alipay.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   



</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/books/"
              rel="noopener noreferrer"
              target="_self"
              >
              阅读
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
