<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>PostgreSQL中文全文搜索 | emacsist</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="postgresql,database," />
  

  <meta name="description" content="安装 zhparserzhparser 使用创建测试表: create table ts (name varchar(1024));  sky=# select * from ts limit 50;              name              ------------------------------  中国人民  中国人民解放军  中国人民解放军，军队  中国军人  中国军">
<meta name="keywords" content="postgresql,database">
<meta property="og:type" content="article">
<meta property="og:title" content="PostgreSQL中文全文搜索">
<meta property="og:url" content="https://emacsist.github.io/2016/08/11/PostgreSQL中文全文搜索/index.html">
<meta property="og:site_name" content="emacsist">
<meta property="og:description" content="安装 zhparserzhparser 使用创建测试表: create table ts (name varchar(1024));  sky=# select * from ts limit 50;              name              ------------------------------  中国人民  中国人民解放军  中国人民解放军，军队  中国军人  中国军">
<meta property="og:updated_time" content="2016-11-11T13:42:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PostgreSQL中文全文搜索">
<meta name="twitter:description" content="安装 zhparserzhparser 使用创建测试表: create table ts (name varchar(1024));  sky=# select * from ts limit 50;              name              ------------------------------  中国人民  中国人民解放军  中国人民解放军，军队  中国军人  中国军">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b870e52c6cd914cb42627e4a706700b7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  

  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header LEFT">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/books/"
            rel="noopener noreferrer"
            target="_self"
            >
            阅读
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-zhparser"><span class="toc-text">安装 zhparser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建索引"><span class="toc-text">创建索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#全文搜索-VS-LKIE"><span class="toc-text">全文搜索 VS LKIE</span></a></li></ol>
  </div>



<div class="content content-post LEFT">
   <article id="post-PostgreSQL中文全文搜索" class="article article-type-post" itemprop="blogPost">
    <header class="article-header">
        <h1 class="post-title">
            PostgreSQL中文全文搜索
        </h1>

        <div class="article-meta">
            <span>
        <i class="icon-calendar"></i>
        <span>2016.08.11</span>
            </span>

            
                <span class="article-author">
          <i class="icon-user"></i>
          <span>emacsist</span>
                </span>
                

                    
    <span class="article-category">
    <i class="icon-list"></i>
    
      <a class="tag-item" href="/tags/#database">
        <span class="tag-name">database</span>
    <span class="tag-size">( 73 )</span>
    </a>
    
      <a class="tag-item" href="/tags/#postgresql">
        <span class="tag-name">postgresql</span>
    <span class="tag-size">( 57 )</span>
    </a>
    

        </span>
        

                        

                                

                                        

        </div>
    </header>

    <div class="article-content">
        
                            <h2 id="安装-zhparser"><a href="#安装-zhparser" class="headerlink" title="安装 zhparser"></a>安装 zhparser</h2><p><a href="https://github.com/amutu/zhparser" target="_blank" rel="external">zhparser</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>创建测试表:</p>
<pre><code class="bash">create table ts (name varchar(1024));

sky=# select * from ts limit 50;
             name             
------------------------------
 中国人民
 中国人民解放军
 中国人民解放军，军队
 中国军人
 中国军队
 中国军队1
 中国军队一二三
 中国军队一二三四
 军队一二三四
 中国军队一三四
 中国军队一三
 中国军队一
 中国军队
 中国
 中
 中国军
 中国军
 为什么
 为国
 中军队
 中军队你
 中军队，解放 
 中军队，解放军
 中军队，解放军队
 中军队，解放军军队
 中军队，解放军军队呀
 中军队，解放军军队呀哈哈
 中军队，解放军军队呀哈哈哈
 中军队，解放军军队呀哈哈哈哈
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
 你好
....


sky=# select count(1) from ts;
 count 
-------
 65565
(1 row)

sky=#
</code></pre>
<p>插入足够多的测试数据。这里是65565条数据。</p>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><blockquote>
<p>下面假设你已经安装并配置好了<code>zhparser</code>.</p>
</blockquote>
<p><code>zhparser.multi_short = on;</code>设置为全局级别后再创建索引.</p>
<pre><code class="bash">alter role all set zhparser.multi_short=on;
</code></pre>
<p>创建索引:</p>
<pre><code class="bash">create index idx_name on ts using gin(to_tsvector(&#39;testzhcfg&#39;, name));
</code></pre>
<h2 id="全文搜索-VS-LKIE"><a href="#全文搜索-VS-LKIE" class="headerlink" title="全文搜索 VS LKIE"></a>全文搜索 VS LKIE</h2><pre><code class="bash">sky=# explain analyze select * from ts where to_tsvector(&#39;testzhcfg&#39;, name) @@ to_tsquery(&#39;testzhcfg&#39;, &#39;军队&#39;);
                                                     QUERY PLAN                                                      
---------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on ts  (cost=10.54..401.46 rows=328 width=7) (actual time=0.010..0.011 rows=20 loops=1)
   Recheck Cond: (to_tsvector(&#39;testzhcfg&#39;::regconfig, (name)::text) @@ &#39;&#39;&#39;军队&#39;&#39;&#39;::tsquery)
   Heap Blocks: exact=1
   -&gt;  Bitmap Index Scan on idx_name  (cost=0.00..10.46 rows=328 width=0) (actual time=0.007..0.007 rows=20 loops=1)
         Index Cond: (to_tsvector(&#39;testzhcfg&#39;::regconfig, (name)::text) @@ &#39;&#39;&#39;军队&#39;&#39;&#39;::tsquery)
 Planning time: 0.071 ms
 Execution time: 0.026 ms
(7 rows)

sky=# 


LIKE:


sky=# explain analyze  select * from ts where name like &#39;%军队%&#39;;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Seq Scan on ts  (cost=0.00..1110.56 rows=3 width=7) (actual time=0.008..5.212 rows=20 loops=1)
   Filter: ((name)::text ~~ &#39;%军队%&#39;::text)
   Rows Removed by Filter: 65545
 Planning time: 0.042 ms
 Execution time: 5.223 ms
(5 rows)

sky=#
</code></pre>
<p>看来还是挺不错的.</p>

                                
    </div>
</article>

   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持 emacsist</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/img/wxpay.jpeg" alt="">
          </li>
        
          <li class="item">
            <img src="/img/alipay.jpeg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   



</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/books/"
              rel="noopener noreferrer"
              target="_self"
              >
              阅读
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
